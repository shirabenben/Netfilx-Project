<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= episode.title %> - Player</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #000; color: #fff; text-align: center; margin:0; padding:0; }
    .player-container { position: relative; max-width: 100%; height: 90vh; background-color: #111; }
    video { width: 100%; height: 100%; background-color: black; }
    .controls { position: absolute; bottom: 10px; width: 100%; display: flex; justify-content: center; align-items: center; gap: 10px; background: rgba(0,0,0,0.6); padding: 10px; border-radius: 10px; }
    .timeline { width: 40%; }
    .overlay-episodes { position: fixed; right: -450px; top:0; height:100%; width:450px; background-color: rgba(20,20,20,0.95); color:white; transition: right 0.4s ease; overflow-y:auto; padding:20px; z-index:1000; }
    .overlay-episodes.active { right: 0; }
    .episode-item { display:flex; align-items:center; border-bottom:1px solid #333; padding:10px 0; cursor:pointer; gap:10px; }
    .episode-item:hover { background-color:#222; }
    .episode-thumb { width:80px; height:45px; object-fit:cover; border-radius:5px; }
    .episode-title { flex:1; text-align:left; }
    .current-episode { background-color:#e50914; color:#fff; font-weight:bold; border-radius:5px; }
    .btn-control { background:#e50914; border:none; padding:8px 12px; border-radius:5px; color:#fff; }
    .btn-control:hover { background:#b20710; }
    #closeOverlay { background:#444; float:right; margin-bottom:10px; }
  </style>
</head>
<body>

<div class="player-container">
  <video id="video-player" src="<%= episode.videoUrl %>" controls></video>

  <div class="controls">
    <button id="rewind" class="btn-control">‚è™ 10s</button>
    <button id="play-pause" class="btn-control">‚ñ∂Ô∏è / ‚è∏</button>
    <button id="forward" class="btn-control">‚è© 10s</button>
    <input type="range" id="timeline" class="form-range timeline" min="0" value="0">
    <button id="fullscreen" class="btn-control">‚õ∂</button>
    <button id="nextEpisode" class="btn-control">Next ‚ñ∂Ô∏è</button>
    <button id="toggleEpisodes" class="btn-control">üì∫ Episodes</button>
  </div>
</div>

<div id="episodesOverlay" class="overlay-episodes">
  <button id="closeOverlay" class="btn btn-sm">‚úñ Close</button>
  <h3>Episodes</h3>
  <% if (episodes.length > 0) { %>
    <% episodes.forEach(ep => { %>
      <div class="episode-item <%= ep._id.equals(episode._id) ? 'current-episode' : '' %>" 
           onclick="window.location.href='/player/<%= ep._id %>'">
        <img src="<%= ep.imageUrl || '/placeholder.jpg' %>" alt="Thumb" class="episode-thumb">
        <div class="episode-title">
          <strong>Episode <%= ep.episodeNumber %></strong> - <%= ep.title %>
        </div>
      </div>
    <% }) %>
  <% } else { %>
    <p>No episode list available.</p>
  <% } %>
</div>

<!-- Pass profile and content IDs to JS -->
<script>
  window.PROFILE_ID = "<%= profile ? profile._id : '' %>";
  window.CONTENT_ID = "<%= episode._id %>";
  window.EPISODES = <%- JSON.stringify(episodes) %>;
</script>

<script src="/player.js"></script>

</body>
</html>
